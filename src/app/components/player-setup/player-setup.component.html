<div class="player-setup-container" role="main">
  <!-- Header -->
  <div class="setup-header">
    <img src="DL-logo.svg" alt="DL Logo" class="dl-logo" />
  </div>

  <!-- Step 1: Initial Configuration -->
  <div class="initial-config" *ngIf="!showPlayerNameForm">
    <div class="config-card">
      <h2>C·∫•u h√¨nh Game</h2>
      <p class="instruction">
        Nh·∫≠p s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i (t·ªëi thi·ªÉu {{ MIN_PLAYERS }}) v√† s·ªë l∆∞·ª£ng team ({{ MIN_TEAMS }}-{{ MAX_TEAMS }}).
      </p>

      <div class="form-group">
        <label for="playerCount">S·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i:</label>
        <input
          type="number"
          id="playerCount"
          name="playerCount"
          [(ngModel)]="playerCount"
          [min]="MIN_PLAYERS"
          class="input-field"
          [class.error]="playerCountError"
          placeholder="V√≠ d·ª•: 34"
          autocomplete="off"
        />
        <div class="error-message" *ngIf="playerCountError">{{ playerCountError }}</div>
      </div>

      <div class="form-group">
        <label for="teamCount">S·ªë l∆∞·ª£ng team:</label>
        <input
          type="number"
          id="teamCount"
          name="teamCount"
          [(ngModel)]="teamCount"
          [min]="MIN_TEAMS"
          [max]="MAX_TEAMS"
          class="input-field"
          [class.error]="teamCountError"
          (keyup.enter)="onPlayerCountSubmit()"
          placeholder="V√≠ d·ª•: 7"
          autocomplete="off"
        />
        <div class="error-message" *ngIf="teamCountError">{{ teamCountError }}</div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-primary" (click)="onPlayerCountSubmit()">
          Ti·∫øp theo
        </button>
        <button type="button" class="btn btn-demo" (click)="insertDemoData()">
          Insert 2025 Data
        </button>
      </div>
    </div>
  </div>

  <!-- Step 2: Main Configuration Grid (3 columns) -->
  <div class="main-config-grid" *ngIf="showPlayerNameForm">
    <form (ngSubmit)="onPlayerNamesSubmit()" class="config-form" novalidate>
      
      <!-- Column 1: Team Colors -->
      <div class="config-card team-colors-card">
        <h3>üé® M√†u s·∫Øc Team</h3>
        <p class="card-instruction">Ch·ªçn m√†u cho m·ªói team</p>
        
        <div class="team-colors-list">
          <div class="team-color-row" *ngFor="let team of teams; let i = index">
            <span class="team-label">Team {{ i + 1 }}:</span>
            <div class="color-picker">
              <button 
                *ngFor="let color of availableColors"
                type="button"
                class="color-btn"
                [style.background]="color.value"
                [class.selected]="team.color === color.value"
                [class.disabled]="isColorUsed(color.value, team.id)"
                [disabled]="isColorUsed(color.value, team.id)"
                (click)="selectTeamColor(team.id, color.value)"
                [attr.title]="color.name">
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 2: Player Names -->
      <div class="config-card player-names-card">
        <h3>üë• Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i</h3>
        <p class="card-instruction">{{ playerNames.length }} ng∆∞·ªùi ch∆°i</p>

        <div class="general-error" *ngIf="generalError">{{ generalError }}</div>

        <div class="player-inputs-container">
          <div class="player-row" *ngFor="let player of playerNames; let i = index">
            <input
              type="number"
              class="order-input"
              [class.order-duplicate]="isDuplicateOrder(i)"
              [(ngModel)]="player.order"
              [name]="'order-' + i"
              [min]="1"
              [max]="playerNames.length"
              placeholder=""
              title="Nh·∫≠p s·ªë th·ª© t·ª± ch∆°i"
            />
            <input
              type="text"
              [id]="'player-' + i"
              [name]="'player-' + i"
              [(ngModel)]="player.name"
              class="input-field player-name-input"
              [class.error]="player.error"
              [class.valid]="player.name.trim() && !player.error"
              (blur)="onPlayerNameBlur(i)"
              (input)="onPlayerNameInput(i)"
              placeholder="T√™n ng∆∞·ªùi ch∆°i"
              maxlength="50"
              autocomplete="off"
            />
            <select
              [id]="'team-' + i"
              [name]="'team-' + i"
              [(ngModel)]="player.teamId"
              class="team-dropdown"
            >
              <option *ngFor="let team of teams; let j = index" [value]="team.id">
                T{{ j + 1 }}
              </option>
            </select>
            <span 
              class="team-color-dot" 
              [style.background]="getTeamById(player.teamId)?.color || '#ccc'">
            </span>
            <button 
              type="button" 
              class="delete-btn" 
              (click)="removePlayer(i)"
              title="X√≥a ng∆∞·ªùi ch∆°i">‚úï</button>
            <div class="player-error" *ngIf="player.error">{{ player.error }}</div>
          </div>
        </div>
        
        <!-- Add player button -->
        <div class="add-player-section">
          <button type="button" class="btn btn-add-player" (click)="addPlayer()">
            + Th√™m ng∆∞·ªùi ch∆°i
          </button>
        </div>
      </div>

      <!-- Column 3: Game Settings (Map Type + Winning Positions + Actions) -->
      <div class="config-card game-settings-card">
        <!-- Map Type Section -->
        <div class="settings-section map-type-section">
          <h3>üó∫Ô∏è Ch·∫ø ƒë·ªô Map</h3>
          <div class="map-options">
            <label class="radio-option">
              <input type="radio" name="mapType" value="random" [(ngModel)]="mapType" />
              <span class="option-label">Random Map</span>
              <span class="map-description">V·ªã tr√≠ r·∫Øn v√† thang ng·∫´u nhi√™n</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="mapType" value="fixed" [(ngModel)]="mapType" />
              <span class="option-label">Fixed Map</span>
              <span class="map-description">V·ªã tr√≠ r·∫Øn v√† thang c·ªë ƒë·ªãnh</span>
            </label>
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- Winning Positions Section -->
        <div class="settings-section winning-positions-section">
          <h3>üèÜ V·ªã tr√≠ chi·∫øn th·∫Øng</h3>
          <p class="card-instruction" *ngIf="showDefault16">V·ªã tr√≠ 16 m·∫∑c ƒë·ªãnh (K·ª∑ ni·ªám 16 nƒÉm)</p>
          <p class="card-instruction" *ngIf="!showDefault16">Nh·∫≠p v·ªã tr√≠ t·ª´ 1-{{ playerCount }}</p>

          <div class="positions-display">
            <span class="position-badge default" *ngIf="showDefault16">üèÜ #16</span>
            <span class="position-badge additional" *ngFor="let pos of additionalWinningPositions">
              ‚≠ê #{{ pos }}
              <button type="button" class="remove-btn" (click)="removeWinningPosition(pos)">‚úï</button>
            </span>
            <span class="no-positions" *ngIf="!showDefault16 && additionalWinningPositions.length === 0">
              Ch∆∞a c√≥ v·ªã tr√≠ n√†o
            </span>
          </div>

          <div class="add-position-row">
            <input
              type="number"
              class="input-field position-input"
              [(ngModel)]="newWinningPosition"
              [name]="'newWinningPosition'"
              (input)="onWinningPositionInput()"
              (keyup.enter)="addWinningPosition()"
              [min]="1"
              [max]="playerCount"
              placeholder="V·ªã tr√≠"
              [class.error]="winningPositionError"
            />
            <button
              type="button"
              class="btn btn-add"
              (click)="addWinningPosition()"
              [disabled]="!isValidWinningPosition()">
              + Th√™m
            </button>
          </div>
          <div class="error-message" *ngIf="winningPositionError">{{ winningPositionError }}</div>
        </div>

        <div class="section-divider"></div>

        <!-- Action Buttons -->
        <div class="action-buttons-section">
          <button type="button" class="btn btn-secondary" (click)="goBackToPlayerCount()">
            ‚Üê Quay l·∫°i
          </button>
          <button type="submit" class="btn btn-primary btn-start">
            üéÆ B·∫Øt ƒë·∫ßu ch∆°i
          </button>
        </div>
      </div>

    </form>
  </div>
</div>
